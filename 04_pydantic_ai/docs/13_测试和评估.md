# Pydantic AI æµ‹è¯•å’Œè¯„ä¼°

> æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ç³»ç»ŸåŒ–åœ°æµ‹è¯•å’Œè¯„ä¼°ä½ çš„ Agent åº”ç”¨ã€‚

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

```python
import pytest
from pydantic_ai.models.test import TestModel

def test_agent_logic():
    """ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å‹æµ‹è¯•"""
    test_model = TestModel(custom_result='æµ‹è¯•å“åº”')
    agent = Agent(test_model)

    result = agent.run_sync('ä»»ä½•æç¤º')
    assert result.data == 'æµ‹è¯•å“åº”'
```

### æµ‹è¯•å·¥å…·å‡½æ•°

```python
@agent.tool
def calculate(ctx, a: float, b: float) -> float:
    """è®¡ç®—å‡½æ•°"""
    return a + b

def test_calculate():
    """æµ‹è¯•å·¥å…·"""
    assert calculate(None, 2, 3) == 5
```

### æµ‹è¯•ä¾èµ–æ³¨å…¥

```python
from unittest.mock import Mock

@pytest.fixture
def test_deps():
    return TestDeps(database=Mock())

async def test_with_deps(test_deps):
    agent = Agent('openai:gpt-4', deps_type=TestDeps)

    with agent.override(deps=test_deps):
        result = await agent.run('æŸ¥è¯¢')
        test_deps.database.query.assert_called_once()
```

## ğŸ“Š è¯„ä¼°å‡†ç¡®æ€§

### åŸºç¡€è¯„ä¼°

```python
async def measure_accuracy(agent, test_cases):
    """è¯„ä¼°å‡†ç¡®æ€§"""
    correct = 0

    for input_text, expected in test_cases:
        result = await agent.run(input_text)
        if expected.lower() in result.data.lower():
            correct += 1

    return correct / len(test_cases)

# ä½¿ç”¨
test_cases = [
    ("1+1=?", "2"),
    ("é¦–éƒ½æ˜¯åŒ—äº¬çš„å›½å®¶?", "ä¸­å›½"),
]

accuracy = await measure_accuracy(agent, test_cases)
print(f"å‡†ç¡®ç‡: {accuracy * 100:.1f}%")
```

## ğŸ“ˆ æ€§èƒ½æµ‹è¯•

### å»¶è¿Ÿæµ‹è¯•

```python
import time

async def measure_latency(agent, prompts):
    """æµ‹é‡å»¶è¿Ÿ"""
    latencies = []

    for prompt in prompts:
        start = time.time()
        await agent.run(prompt)
        latencies.append(time.time() - start)

    return {
        'avg': sum(latencies) / len(latencies),
        'max': max(latencies),
        'min': min(latencies)
    }
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆ†å±‚æµ‹è¯•

```python
# å•å…ƒæµ‹è¯•ï¼šå¿«é€Ÿ
def test_tool():
    pass

# é›†æˆæµ‹è¯•ï¼šå®Œæ•´æµç¨‹
@pytest.mark.integration
async def test_workflow():
    pass
```

### 2. ä½¿ç”¨ Fixtures

```python
@pytest.fixture
def agent():
    return Agent('openai:gpt-4')

def test_with_fixture(agent):
    result = agent.run_sync('æµ‹è¯•')
```

### 3. å‚æ•°åŒ–æµ‹è¯•

```python
@pytest.mark.parametrize('input,expected', [
    ('1+1', '2'),
    ('2+2', '4'),
])
async def test_math(agent, input, expected):
    result = await agent.run(input)
    assert expected in result.data
```

## ğŸ“š å‚è€ƒèµ„æº

- [Pytest æ–‡æ¡£](https://docs.pytest.org/)
- [14_æœ€ä½³å®è·µ.md](./14_æœ€ä½³å®è·µ.md)
