# Pydantic AI æ ¸å¿ƒæ¦‚å¿µ

> æœ¬æ–‡æ¡£æ·±å…¥è®²è§£ Pydantic AI çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¸®åŠ©ä½ å»ºç«‹æ‰å®çš„ç†è®ºåŸºç¡€ã€‚

## ğŸ“ æ¶æ„æ¦‚è§ˆ

Pydantic AI çš„æ ¸å¿ƒæ¶æ„ç”±ä»¥ä¸‹ç»„ä»¶æ„æˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Application                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Agent                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ System     â”‚  â”‚ Tools       â”‚  â”‚ Output    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Prompt     â”‚  â”‚             â”‚  â”‚ Type      â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â”‚
â”‚  â”‚  â”‚ Model      â”‚  â”‚ Dependenciesâ”‚                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              RunContext                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ deps       â”‚  â”‚ messages    â”‚  â”‚ usage     â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LLM Provider                          â”‚
â”‚         (OpenAI, Anthropic, Google, etc.)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¤– Agentï¼ˆä»£ç†ï¼‰

### å®šä¹‰

**Agent æ˜¯ Pydantic AI çš„ä¸»è¦æ¥å£**ï¼Œç”¨äºä¸ LLM äº¤äº’ã€‚å®ƒæ˜¯ä¸€ä¸ªå®¹å™¨ï¼ŒåŒ…å«ï¼š

- **æŒ‡ä»¤ï¼ˆInstructionsï¼‰**: å¼€å‘è€…ç¼–å†™çš„ LLM æŒ‡å¯¼
- **å·¥å…·ï¼ˆToolsï¼‰**: LLM å¯ä»¥è°ƒç”¨çš„å‡½æ•°
- **ç»“æ„åŒ–è¾“å‡ºç±»å‹ï¼ˆOutput Typeï¼‰**: æœŸæœ›çš„å“åº”æ ¼å¼
- **ä¾èµ–ç±»å‹çº¦æŸï¼ˆDependency Typeï¼‰**: åŠ¨æ€ä¸Šä¸‹æ–‡æ³¨å…¥
- **LLM æ¨¡å‹ï¼ˆModelï¼‰**: å…³è”çš„è¯­è¨€æ¨¡å‹
- **æ¨¡å‹è®¾ç½®ï¼ˆModel Settingsï¼‰**: è¯·æ±‚çš„ç»†ç²’åº¦é…ç½®

### Agent çš„æ³›å‹ç‰¹æ€§

Agent æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ `Agent[Dependencies, OutputType]`ï¼š

```python
from pydantic_ai import Agent
from pydantic import BaseModel
from dataclasses import dataclass


@dataclass
class MyDeps:
    database_url: str


class MyOutput(BaseModel):
    result: str


# Agent çš„å®Œæ•´ç±»å‹ç­¾å
agent: Agent[MyDeps, MyOutput] = Agent(
    'openai:gpt-4',
    deps_type=MyDeps,
    output_type=MyOutput
)

# ç±»å‹æ¨æ–­
result = agent.run_sync('query', deps=MyDeps('postgres://...'))
# result.data çš„ç±»å‹æ˜¯ MyOutput
```

**ç±»å‹å®‰å…¨çš„å¥½å¤„**ï¼š
- IDE è‡ªåŠ¨è¡¥å…¨
- é™æ€ç±»å‹æ£€æŸ¥ï¼ˆmypy, pyrightï¼‰
- åœ¨ç¼–è¯‘æ—¶å‘ç°é”™è¯¯
- æ›´å¥½çš„ä»£ç é‡æ„æ”¯æŒ

### Agent çš„åˆ›å»º

```python
# æœ€ç®€å•çš„ Agent
agent = Agent('openai:gpt-4')

# å®Œæ•´é…ç½®çš„ Agent
agent = Agent(
    model='anthropic:claude-3-5-sonnet-20241022',
    deps_type=MyDeps,
    output_type=MyOutput,
    system_prompt='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•°æ®åˆ†æå¸ˆã€‚',
    tools=[tool1, tool2],
    retries=3,
    model_settings={'temperature': 0.7, 'max_tokens': 2000}
)
```

**å‚æ•°è¯´æ˜**ï¼š
- `model`: æ¨¡å‹åç§°ï¼Œæ ¼å¼ä¸º `provider:model`
- `deps_type`: ä¾èµ–ç±»å‹ï¼ˆç”¨äºç±»å‹æ£€æŸ¥ï¼‰
- `output_type`: è¾“å‡ºç±»å‹ï¼ˆé»˜è®¤ä¸º `str`ï¼‰
- `system_prompt`: é™æ€ç³»ç»Ÿæç¤º
- `tools`: å·¥å…·åˆ—è¡¨
- `retries`: å¤±è´¥é‡è¯•æ¬¡æ•°
- `model_settings`: æ¨¡å‹é…ç½®ï¼ˆæ¸©åº¦ã€æœ€å¤§ token ç­‰ï¼‰

### Agent çš„é‡ç”¨

**é‡è¦åŸåˆ™**: Agent å®ä¾‹åº”è¯¥è¢«å…¨å±€é‡ç”¨ï¼Œç±»ä¼¼ FastAPI çš„ app å®ä¾‹ã€‚

```python
# âœ… æ¨èï¼šå…¨å±€å•ä¾‹
agent = Agent('openai:gpt-4')

def process_request(user_input: str):
    return agent.run_sync(user_input)

# âŒ ä¸æ¨èï¼šæ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹
def process_request(user_input: str):
    agent = Agent('openai:gpt-4')  # æµªè´¹èµ„æº
    return agent.run_sync(user_input)
```

## ğŸƒ è¿è¡Œæ–¹å¼

Pydantic AI æä¾› **5 ç§è¿è¡Œæ–¹å¼**ï¼Œé€‚åº”ä¸åŒåœºæ™¯ï¼š

### 1. `agent.run()` - å¼‚æ­¥è¿è¡Œ

è¿”å›å®Œæ•´çš„ `RunResult`ï¼š

```python
async def main():
    result = await agent.run('ç”¨æˆ·æç¤º')

    print(result.data)              # è¾“å‡ºæ•°æ®
    print(result.usage())           # Token ä½¿ç”¨æƒ…å†µ
    print(result.all_messages())    # å®Œæ•´æ¶ˆæ¯å†å²
```

**ç‰¹ç‚¹**ï¼š
- å¼‚æ­¥æ‰§è¡Œï¼Œé€‚åˆé«˜å¹¶å‘
- è¿”å›å®Œæ•´çš„è¿è¡Œç»“æœ
- åŒ…å«æ‰€æœ‰å…ƒæ•°æ®å’Œå†å²

### 2. `agent.run_sync()` - åŒæ­¥è¿è¡Œ

åŒæ­¥åŒ…è£…å™¨ï¼š

```python
result = agent.run_sync('ç”¨æˆ·æç¤º')
print(result.data)
```

**ç‰¹ç‚¹**ï¼š
- åŒæ­¥æ‰§è¡Œï¼Œé€‚åˆç®€å•è„šæœ¬
- åº•å±‚ä»ä½¿ç”¨å¼‚æ­¥ï¼Œä½†è‡ªåŠ¨å¤„ç†äº‹ä»¶å¾ªç¯
- è¿”å›å€¼ä¸ `run()` ç›¸åŒ

### 3. `agent.run_stream()` - æµå¼ä¼ è¾“

å®æ—¶æµå¼å“åº”ï¼š

```python
async def main():
    async with agent.run_stream('ç”Ÿæˆé•¿æ–‡æœ¬') as stream:
        async for text in stream.stream_text():
            print(text, end='', flush=True)

        # è·å–æœ€ç»ˆç»“æœ
        result = await stream.get_result()
```

**ç‰¹ç‚¹**ï¼š
- å®æ—¶é€å­—/é€å¥è¾“å‡º
- æå‡ç”¨æˆ·ä½“éªŒ
- æ”¯æŒæµå¼ç»“æ„åŒ–è¾“å‡º

### 4. `agent.run_stream_events()` - äº‹ä»¶æµ

è¿”å›æ‰€æœ‰äº‹ä»¶çš„å¼‚æ­¥è¿­ä»£å™¨ï¼š

```python
async def main():
    async for event in agent.run_stream_events('æç¤º'):
        if event.type == 'text':
            print(event.data, end='')
        elif event.type == 'tool_call':
            print(f"\nè°ƒç”¨å·¥å…·: {event.tool_name}")
```

**ç‰¹ç‚¹**ï¼š
- ç»†ç²’åº¦æ§åˆ¶
- ç›‘æ§å·¥å…·è°ƒç”¨
- é€‚åˆå¤æ‚çš„ UI é›†æˆ

### 5. `agent.iter()` - å›¾è¿­ä»£

ä½çº§åˆ«çš„èŠ‚ç‚¹é€æ­¥æ§åˆ¶ï¼š

```python
async def main():
    async for node in agent.iter('æç¤º'):
        print(f"èŠ‚ç‚¹ç±»å‹: {node.type}")
        if node.type == 'tool_call':
            # å¯ä»¥å¹²é¢„æˆ–ä¿®æ”¹å·¥å…·è°ƒç”¨
            pass
```

**ç‰¹ç‚¹**ï¼š
- æœ€ç»†ç²’åº¦çš„æ§åˆ¶
- é€‚åˆå›¾å·¥ä½œæµ
- å¯ä»¥å¹²é¢„æ‰§è¡Œæµç¨‹

## ğŸ’¬ æ¶ˆæ¯å’Œå†å²

### å•æ¬¡è¿è¡Œ vs å¯¹è¯

**å•æ¬¡è¿è¡Œ**ï¼š

```python
result = agent.run_sync('ä½ å¥½')
# æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ— å†å²è®°å¿†
```

**æŒç»­å¯¹è¯**ï¼š

```python
# ç¬¬ä¸€è½®
result1 = agent.run_sync('æˆ‘å«å¼ ä¸‰')

# ç¬¬äºŒè½® - ä¼ é€’å†å²æ¶ˆæ¯
result2 = agent.run_sync(
    'æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ',
    message_history=result1.new_messages()
)
# LLM ä¼šè®°ä½ç¬¬ä¸€è½®çš„ä¸Šä¸‹æ–‡
```

### æ¶ˆæ¯ç±»å‹

Pydantic AI ä½¿ç”¨æ ‡å‡†çš„æ¶ˆæ¯ç±»å‹ï¼š

```python
from pydantic_ai.messages import (
    ModelMessage,      # LLM å“åº”
    UserMessage,       # ç”¨æˆ·è¾“å…¥
    SystemMessage,     # ç³»ç»Ÿæç¤º
    ToolCallMessage,   # å·¥å…·è°ƒç”¨
    ToolReturnMessage  # å·¥å…·è¿”å›
)

# æŸ¥çœ‹æ‰€æœ‰æ¶ˆæ¯
for msg in result.all_messages():
    if isinstance(msg, UserMessage):
        print(f"ç”¨æˆ·: {msg.content}")
    elif isinstance(msg, ModelMessage):
        print(f"AI: {msg.content}")
```

## ğŸ§° RunContextï¼ˆè¿è¡Œä¸Šä¸‹æ–‡ï¼‰

### å®šä¹‰

**RunContext æ˜¯ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒæœºåˆ¶**ï¼Œåœ¨è¿è¡Œæ—¶ä¼ é€’ä¸Šä¸‹æ–‡ç»™ï¼š
- ç³»ç»Ÿæç¤º
- å·¥å…·å‡½æ•°
- è¾“å‡ºéªŒè¯å™¨

### ç±»å‹ç­¾å

```python
RunContext[DepsType]
```

**æ³›å‹å‚æ•°**ï¼š
- `DepsType`: ä¾èµ–çš„ç±»å‹

### è®¿é—®ä¾èµ–

```python
from pydantic_ai import Agent, RunContext


agent = Agent('openai:gpt-4', deps_type=MyDeps)


@agent.tool
def my_tool(ctx: RunContext[MyDeps]) -> str:
    # é€šè¿‡ ctx.deps è®¿é—®ä¾èµ–
    database = ctx.deps.database
    api_key = ctx.deps.api_key

    return "result"
```

### RunContext çš„å±æ€§

```python
@agent.tool
def inspect_context(ctx: RunContext[MyDeps]) -> str:
    # ä¾èµ–å¯¹è±¡
    deps = ctx.deps

    # å½“å‰æ¶ˆæ¯å†å²
    messages = ctx.messages

    # Token ä½¿ç”¨ç»Ÿè®¡
    usage = ctx.usage

    # è¿è¡Œçš„å…ƒæ•°æ®
    metadata = ctx.metadata

    # é‡è¯•æ¬¡æ•°
    retry = ctx.retry

    return "ok"
```

## ğŸ“Š ç»“æ„åŒ–è¾“å‡º

### ä½¿ç”¨ Pydantic æ¨¡å‹

```python
from pydantic import BaseModel, Field


class Recipe(BaseModel):
    """é£Ÿè°±"""
    name: str = Field(description="èœå")
    ingredients: list[str] = Field(description="é£Ÿæåˆ—è¡¨")
    steps: list[str] = Field(description="æ­¥éª¤åˆ—è¡¨")
    cooking_time: int = Field(description="çƒ¹é¥ªæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰")


agent = Agent(
    'openai:gpt-4',
    output_type=Recipe
)

result = agent.run_sync('æ•™æˆ‘åšå®«ä¿é¸¡ä¸')

# result.data æ˜¯ä¸€ä¸ª Recipe å®ä¾‹
print(f"èœå: {result.data.name}")
print(f"é£Ÿæ: {', '.join(result.data.ingredients)}")
print(f"éœ€è¦ {result.data.cooking_time} åˆ†é’Ÿ")
```

### éªŒè¯å™¨

æ·»åŠ è‡ªå®šä¹‰éªŒè¯é€»è¾‘ï¼š

```python
from pydantic_ai import Agent, RunContext


agent = Agent('openai:gpt-4', output_type=Recipe)


@agent.output_validator
def validate_recipe(ctx: RunContext[None], output: Recipe) -> Recipe:
    """éªŒè¯é£Ÿè°±çš„åˆç†æ€§"""
    if output.cooking_time < 0:
        raise ValueError("çƒ¹é¥ªæ—¶é—´ä¸èƒ½ä¸ºè´Ÿæ•°")

    if len(output.ingredients) < 2:
        raise ValueError("è‡³å°‘éœ€è¦ 2 ç§é£Ÿæ")

    return output
```

## ğŸ”§ System Prompt vs Instructions

### System Promptï¼ˆç³»ç»Ÿæç¤ºï¼‰

**ç‰¹ç‚¹**ï¼š
- åœ¨ä½¿ç”¨ `message_history` æ—¶ä¼šè¢«ä¿ç•™
- é€‚åˆå®šä¹‰ Agent çš„**æŒä¹…èº«ä»½**

```python
agent = Agent(
    'openai:gpt-4',
    system_prompt='ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœä»£è¡¨ã€‚'
)
```

### Instructionsï¼ˆæŒ‡ä»¤ï¼‰

**ç‰¹ç‚¹**ï¼š
- ä¼šè¢«å½“å‰ Agent çš„æŒ‡ä»¤æ›¿æ¢
- æ¨èç”¨äºå¤§å¤šæ•°åœºæ™¯

```python
agent = Agent(
    'openai:gpt-4',
    instructions='æå–åŸå¸‚ä¿¡æ¯ã€‚'
)
```

### åŠ¨æ€ Prompt/Instructions

ä¸¤è€…éƒ½æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆï¼š

```python
@agent.system_prompt
def get_system_prompt(ctx: RunContext[MyDeps]) -> str:
    user_level = ctx.deps.user_level
    return f'ä½ æ˜¯ä¸€ä¸ª {user_level} çº§åˆ«çš„åŠ©æ‰‹ã€‚'


@agent.instructions
async def get_instructions(ctx: RunContext[MyDeps]) -> str:
    settings = await ctx.deps.load_settings()
    return f'æ ¹æ®è®¾ç½® {settings} æä¾›ç­”æ¡ˆã€‚'
```

## ğŸ›ï¸ æ¨¡å‹è®¾ç½®

### ModelSettings

é…ç½® LLM è¯·æ±‚å‚æ•°ï¼š

```python
from pydantic_ai import Agent, ModelSettings

agent = Agent(
    'openai:gpt-4',
    model_settings=ModelSettings(
        temperature=0.7,      # åˆ›é€ æ€§ï¼ˆ0-2ï¼‰
        max_tokens=2000,      # æœ€å¤§ç”Ÿæˆé•¿åº¦
        timeout=30,           # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
        top_p=0.9,           # æ ¸é‡‡æ ·
    )
)
```

### ä¸‰çº§ä¼˜å…ˆçº§

**ä¼˜å…ˆçº§é¡ºåº**ï¼šè¿è¡Œæ—¶ > Agent > æ¨¡å‹é»˜è®¤

```python
# 1. Agent çº§åˆ«
agent = Agent(
    'openai:gpt-4',
    model_settings=ModelSettings(temperature=0.5)
)

# 2. è¿è¡Œæ—¶è¦†ç›–
result = agent.run_sync(
    'æç¤º',
    model_settings=ModelSettings(temperature=0.9)  # è¦†ç›– Agent çº§åˆ«
)

# 3. æ¨¡å‹é»˜è®¤å€¼ï¼ˆæœªæŒ‡å®šæ—¶ä½¿ç”¨ï¼‰
```

## ğŸ“ ä½¿ç”¨é™åˆ¶

### UsageLimits

é˜²æ­¢ Agent å¤±æ§ï¼š

```python
from pydantic_ai import Agent, UsageLimits

agent = Agent(
    'openai:gpt-4',
    usage_limits=UsageLimits(
        response_tokens_limit=10000,  # æœ€å¤§å“åº” token æ•°
        request_limit=50,             # æœ€å¤§è¯·æ±‚æ¬¡æ•°
        tool_calls_limit=20,          # æœ€å¤§å·¥å…·è°ƒç”¨æ¬¡æ•°
    )
)
```

**ä½œç”¨**ï¼š
- é˜²æ­¢æ— é™å¾ªç¯
- æ§åˆ¶æˆæœ¬
- é¿å…è¶…æ—¶

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç±»å‹å®‰å…¨

```python
# âœ… å……åˆ†åˆ©ç”¨ç±»å‹æç¤º
agent: Agent[MyDeps, MyOutput] = Agent(
    'openai:gpt-4',
    deps_type=MyDeps,
    output_type=MyOutput
)

# âŒ é¿å…ä½¿ç”¨ Any
agent: Agent = Agent('openai:gpt-4')
```

### 2. Agent é‡ç”¨

```python
# âœ… å…¨å±€å•ä¾‹
global_agent = Agent('openai:gpt-4')

# âŒ é‡å¤åˆ›å»º
def handler():
    agent = Agent('openai:gpt-4')  # æµªè´¹
```

### 3. ä½¿ç”¨ Instructions è€Œé System Prompt

```python
# âœ… æ¨è
agent = Agent('openai:gpt-4', instructions='...')

# ğŸ¤” ä»…åœ¨éœ€è¦ä¿ç•™å†å²æ—¶ä½¿ç”¨
agent = Agent('openai:gpt-4', system_prompt='...')
```

### 4. è®¾ç½®ä½¿ç”¨é™åˆ¶

```python
# âœ… é˜²æ­¢å¤±æ§
agent = Agent(
    'openai:gpt-4',
    usage_limits=UsageLimits(
        request_limit=10,
        tool_calls_limit=5
    )
)
```

### 5. ç»“æ„åŒ–è¾“å‡ºä¼˜äºçº¯æ–‡æœ¬

```python
# âœ… ç±»å‹å®‰å…¨ï¼Œæ˜“äºå¤„ç†
agent = Agent('openai:gpt-4', output_type=MyModel)

# âŒ éœ€è¦æ‰‹åŠ¨è§£æ
agent = Agent('openai:gpt-4')  # è¿”å›å­—ç¬¦ä¸²
```

## ğŸ“š ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»æŒæ¡äº† Pydantic AI çš„æ ¸å¿ƒæ¦‚å¿µï¼ç»§ç»­å­¦ä¹ ï¼š

1. [03_Agentç³»ç»Ÿ.md](./03_Agentç³»ç»Ÿ.md) - Agent çš„è¯¦ç»†é…ç½®å’Œé«˜çº§ç”¨æ³•
2. [04_å·¥å…·ç³»ç»Ÿ.md](./04_å·¥å…·ç³»ç»Ÿ.md) - å·¥å…·çš„å®šä¹‰ã€æ³¨å†Œå’Œç®¡ç†
3. [05_ä¾èµ–æ³¨å…¥.md](./05_ä¾èµ–æ³¨å…¥.md) - æ·±å…¥ç†è§£ä¾èµ–æ³¨å…¥ç³»ç»Ÿ

## ğŸ”— å‚è€ƒèµ„æº

- [å®˜æ–¹æ–‡æ¡£ - Agents](https://ai.pydantic.dev/agents/)
- [å®˜æ–¹æ–‡æ¡£ - Run Context](https://ai.pydantic.dev/dependencies/)
- [Pydantic æ ¸å¿ƒæ–‡æ¡£](https://docs.pydantic.dev/)
