# Pydantic AI äººæœºåä½œ

> æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•å®ç°äººåœ¨ç¯ä¸­çš„äº¤äº’ï¼ŒåŒ…æ‹¬å·¥å…·å®¡æ‰¹å’Œç”¨æˆ·ç¡®è®¤ã€‚

## ğŸ¤ äººåœ¨ç¯ä¸­ï¼ˆHuman-in-the-Loopï¼‰

### ä¸ºä»€ä¹ˆéœ€è¦ HITLï¼Ÿ

- æ•æ„Ÿæ“ä½œéœ€è¦äººå·¥ç¡®è®¤
- é˜²æ­¢ AI åšå‡ºé”™è¯¯å†³ç­–
- åˆè§„æ€§è¦æ±‚
- ç”¨æˆ·ä¿¡ä»»

## âœ‹ å·¥å…·å®¡æ‰¹

### åŸºç¡€å®¡æ‰¹

```python
from pydantic_ai import Agent, RunContext

agent = Agent('openai:gpt-4')

@agent.tool
def delete_user(ctx: RunContext[None], user_id: str) -> str:
    """åˆ é™¤ç”¨æˆ·ï¼ˆéœ€è¦ç¡®è®¤ï¼‰"""
    # è¯·æ±‚ç”¨æˆ·ç¡®è®¤
    confirmed = input(f"ç¡®è®¤åˆ é™¤ç”¨æˆ· {user_id}? (y/n): ")

    if confirmed.lower() != 'y':
        return "æ“ä½œå·²å–æ¶ˆ"

    # æ‰§è¡Œåˆ é™¤
    return f"ç”¨æˆ· {user_id} å·²åˆ é™¤"
```

### å®¡æ‰¹è£…é¥°å™¨

```python
from functools import wraps

def require_approval(func):
    """å·¥å…·å®¡æ‰¹è£…é¥°å™¨"""
    @wraps(func)
    def wrapper(ctx, *args, **kwargs):
        # æ˜¾ç¤ºæ“ä½œä¿¡æ¯
        print(f"\nâš ï¸  å³å°†æ‰§è¡Œ: {func.__name__}")
        print(f"å‚æ•°: {args}, {kwargs}")

        # è¯·æ±‚ç¡®è®¤
        response = input("ç¡®è®¤æ‰§è¡Œ? (y/n): ")

        if response.lower() != 'y':
            return "æ“ä½œå·²è¢«ç”¨æˆ·å–æ¶ˆ"

        # æ‰§è¡ŒåŸå‡½æ•°
        return func(ctx, *args, **kwargs)

    return wrapper

@agent.tool
@require_approval
def critical_operation(ctx: RunContext[None], data: str) -> str:
    """å…³é”®æ“ä½œ"""
    return f"å·²æ‰§è¡Œ: {data}"
```

## ğŸ“ ç”¨æˆ·è¾“å…¥

### åŠ¨æ€ç”¨æˆ·è¾“å…¥

```python
@agent.tool
def get_user_preference(ctx: RunContext[None], question: str) -> str:
    """è¯¢é—®ç”¨æˆ·åå¥½"""
    print(f"\nâ“ Agent è¯¢é—®: {question}")
    answer = input("ä½ çš„å›ç­”: ")
    return answer

# Agent ä¼šè‡ªåŠ¨è°ƒç”¨å·¥å…·è¯¢é—®ç”¨æˆ·
result = await agent.run('å¸®æˆ‘å®‰æ’ä¸€æ¬¡æ—…è¡Œ')
```

## ğŸ”’ æƒé™æ§åˆ¶

### åŸºäºè§’è‰²çš„å®¡æ‰¹

```python
from dataclasses import dataclass

@dataclass
class UserContext:
    user_id: str
    role: str  # 'admin', 'user'

agent = Agent('openai:gpt-4', deps_type=UserContext)

@agent.tool
def admin_operation(ctx: RunContext[UserContext]) -> str:
    """ç®¡ç†å‘˜æ“ä½œ"""
    if ctx.deps.role != 'admin':
        return "æƒé™ä¸è¶³ï¼šéœ€è¦ç®¡ç†å‘˜æƒé™"

    # å³ä½¿æ˜¯ç®¡ç†å‘˜ï¼Œä¹Ÿéœ€è¦ç¡®è®¤
    confirmed = input("ç¡®è®¤æ‰§è¡Œç®¡ç†å‘˜æ“ä½œ? (y/n): ")
    if confirmed.lower() != 'y':
        return "æ“ä½œå·²å–æ¶ˆ"

    return "ç®¡ç†å‘˜æ“ä½œå·²æ‰§è¡Œ"
```

## ğŸ”— å‚è€ƒèµ„æº

- [04_å·¥å…·ç³»ç»Ÿ.md](./04_å·¥å…·ç³»ç»Ÿ.md) - å·¥å…·å®šä¹‰
- [14_æœ€ä½³å®è·µ.md](./14_æœ€ä½³å®è·µ.md) - å®‰å…¨æœ€ä½³å®è·µ
