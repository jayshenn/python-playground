# Pydantic AI æŒä¹…åŒ–æ‰§è¡Œ

> æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬é‡è¯•ã€å®¹é”™å’ŒçŠ¶æ€ä¿å­˜ã€‚

## ğŸ”„ é‡è¯•æœºåˆ¶

### è‡ªåŠ¨é‡è¯•

```python
from pydantic_ai import Agent

agent = Agent(
    'openai:gpt-4',
    retries=3  # å¤±è´¥åæœ€å¤šé‡è¯•3æ¬¡
)

# å¦‚æœå¤±è´¥ï¼Œä¼šè‡ªåŠ¨é‡è¯•
result = await agent.run('å¯èƒ½å¤±è´¥çš„ä»»åŠ¡')
```

### ModelRetry - è®© LLM è‡ªæˆ‘ä¿®æ­£

```python
from pydantic_ai import ModelRetry

@agent.output_validator
def validate_output(ctx, output):
    if not output.is_valid():
        # è¦æ±‚ LLM é‡æ–°ç”Ÿæˆ
        raise ModelRetry('è¾“å‡ºä¸ç¬¦åˆè¦æ±‚ï¼Œè¯·é‡æ–°ç”Ÿæˆ')
    return output
```

## ğŸ’¾ çŠ¶æ€ä¿å­˜

### ä¿å­˜æ¶ˆæ¯å†å²

```python
import json

# ä¿å­˜å†å²
result = await agent.run('ç¬¬ä¸€è½®å¯¹è¯')
history = result.new_messages()

# åºåˆ—åŒ–ä¿å­˜
with open('history.json', 'w') as f:
    json.dump([msg.model_dump() for msg in history], f)

# åŠ è½½å†å²
with open('history.json') as f:
    loaded_history = json.load(f)

# ç»§ç»­å¯¹è¯
result2 = await agent.run('ç¬¬äºŒè½®å¯¹è¯', message_history=loaded_history)
```

## â° é•¿æ—¶é—´è¿è¡Œä»»åŠ¡

### è¶…æ—¶æ§åˆ¶

```python
import asyncio

try:
    async with asyncio.timeout(300):  # 5åˆ†é’Ÿè¶…æ—¶
        result = await agent.run('é•¿æ—¶é—´ä»»åŠ¡')
except asyncio.TimeoutError:
    print("ä»»åŠ¡è¶…æ—¶")
```

### åˆ†å—å¤„ç†

```python
async def process_large_task(items):
    """åˆ†æ‰¹å¤„ç†å¤§ä»»åŠ¡"""
    batch_size = 10
    results = []

    for i in range(0, len(items), batch_size):
        batch = items[i:i + batch_size]
        result = await agent.run(f'å¤„ç†æ‰¹æ¬¡: {batch}')
        results.append(result.data)

        # ä¿å­˜è¿›åº¦
        save_progress(i + batch_size, results)

    return results
```

## ğŸ”— å‚è€ƒèµ„æº

- [14_æœ€ä½³å®è·µ.md](./14_æœ€ä½³å®è·µ.md) - é”™è¯¯å¤„ç†æœ€ä½³å®è·µ
- [å®˜æ–¹æ–‡æ¡£ - Error Handling](https://ai.pydantic.dev/agents/#error-handling)
